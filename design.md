# アークデータインポートツール - システム設計書

## 1. システム構成

```
┌─────────────────┐    ┌─────────────────┐
│元データファイル1│    │元データファイル2│
│案件取込用レポート│    │ContractList     │
│(40カラム)       │    │(121カラム)      │
└─────────────────┘    └─────────────────┘
           │                        │
           └────────┬───────────────┘
                    │
           ┌─────────▼─────────┐
           │  データ結合・変換   │
           │     エンジン       │
           └─────────┬─────────┘
                    │
           ┌─────────▼─────────┐
           │アーク新規登録CSV   │
           │   (111カラム)     │
           └───────────────────┘
```

## 2. モジュール構成

### 2.1 メインモジュール（main.py）
- プログラム実行のエントリーポイント
- 設定読み込み、処理フロー制御

### 2.2 データ読み込みモジュール（data_loader.py）
- CSVファイル読み込み（CP932対応）
- ファイル存在チェック
- エラーハンドリング

### 2.3 データ変換モジュール（data_transformer.py）
- フィールドマッピング
- データ形式変換
- 固定値設定

### 2.4 データ出力モジュール（data_exporter.py）
- CSV出力（CP932エンコーディング）
- ファイル名生成（日付付き）

### 2.5 設定モジュール（config.py）
- マッピング定義
- 固定値定義
- ファイルパス設定

## 3. データフロー

```
1. 設定読み込み
   ↓
2. 元データファイル読み込み
   - 案件取込用レポート.csv
   - ContractList_YYYYMMDDHHMMSS.csv
   ↓
3. データ結合（利用者番号キー）
   ↓
4. フィールドマッピング変換
   - 基本情報変換
   - 住所分割
   - 日付フォーマット変換
   - 電話番号フォーマット変換
   ↓
5. 固定値設定
   - 銀行情報
   - ステータス情報
   ↓
6. CSV出力
   - 新規登録アーク_YYYYMMDD.csv
```

## 4. 主要なデータ変換ルール

### 4.1 基本情報
- 申請者番号 → 利用者番号
- 申請者氏名 → 申請者氏名 
- 申請者カナ → 申請者カナ（半角→全角変換）

### 4.2 住所情報
- 住所文字列 → 都道府県/市区/それ以外に分割
- 郵便番号フォーマット → XXX-XXXX

### 4.3 固定値
- 金融機関CD → 310
- 金融機関名 → GMOあおぞらネット銀行
- 口座種類 → 普通

## 5. エラーハンドリング
- ファイル不存在エラー
- データフォーマットエラー
- 必須フィールド不足エラー
- エンコーディングエラー