# アークデータインポートツール

アーク新規登録用CSVファイルを自動生成するデータ変換ツールです。

## 概要

2つの元データファイル（案件取込用レポートとContractList）を読み込み、アーク新規登録テンプレート形式のCSVファイルを出力します。

## 機能

- **データ結合**: 利用者番号をキーとした2ファイルの結合
- **重複データ除外**: 契約番号による既登録案件の自動除外
- **データ検証**: 生年月日異常値（1700年代等）の自動除外
- **フィールドマッピング**: 元データからテンプレート形式への変換
- **データ形式変換**: 日付、電話番号、住所分割等の自動変換
- **電話番号処理**: 自宅TEL・携帯の適切な振り分け
- **住所分割**: 現住所を郵便番号/都道府県/市区町村/住所3に自動分割
- **保証人・緊急連絡先処理**: 同一データからの分類・振り分け
- **引継ぎ情報生成**: 入居日と補足文の結合処理
- **固定値設定**: 銀行情報等の固定値自動設定

## ファイル構成

```
ark_import_new_data/
├── main.py              # メイン実行ファイル
├── config.py            # 設定・マッピング定義
├── data_loader.py       # データ読み込み
├── data_transformer.py  # データ変換
├── data_exporter.py     # データ出力
├── requirements.txt     # 依存関係
├── README.md           # このファイル
├── requirements.md      # 要件定義書
├── design.md           # システム設計書
├── tasklist.md         # 実装タスクリスト
├── manual.txt          # 業務マニュアル
└── CLAUDE.md           # Claude Code設定
```

## 使用方法

### 1. 環境構築
```bash
pip install -r requirements.txt
```

### 2. 実行
```bash
python main.py
```

### 3. 入力ファイル
以下のファイルが必要です：
- `C:/Users/user04/Downloads/【東京支店】①案件取込用レポート20250722.csv`
- `C:/Users/user04/Downloads/ContractList_YYYYMMDDHHMMSS.csv`
- `C:/Users/user04/Desktop/新規登録テンプレ.csv`

### 4. 出力ファイル
- `新規登録アーク_YYYYMMDD.csv` (現在のディレクトリに生成)

## 設定変更

`config.py`でファイルパスやマッピング設定を変更できます。

## 注意事項

- CSVファイルはCP932エンコーディングで処理されます
- ContractListファイルは日時付きファイル名に対応しています
- 契約番号による重複チェックで既登録案件は自動除外されます
- 生年月日が1700年代等の異常値データは自動除外されます
- 電話番号は自宅TEL・携帯の適切な振り分けが自動実行されます
- 保証人・緊急連絡先は一旦全て「保証人」として登録後、手動調整が必要です
- 処理中にエラーが発生した場合はログを確認してください

## トラブルシューティング

### よくある問題
1. **ファイルが見つからない**: ファイルパスを確認してください
2. **文字化け**: エンコーディングがCP932であることを確認してください
3. **データ不整合**: 元データの利用者番号が一致しているか確認してください
4. **重複データエラー**: 契約番号に重複がある場合、既登録案件として自動除外されます
5. **異常値除外**: 1700年代等の異常な生年月日は自動除外対象です
6. **電話番号なし**: 自宅TEL・携帯TELどちらも空欄の場合はそのまま処理されます
7. **住所分割エラー**: 住所形式が想定と異なる場合は手動確認が必要です

## 開発情報

- **言語**: Python 3.8+
- **主要ライブラリ**: pandas, chardet
- **対応OS**: Windows
- **エンコーディング**: CP932 (Shift_JIS)