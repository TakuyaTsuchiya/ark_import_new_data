"""
設定・マッピング定義モジュール
"""
import json
from pathlib import Path
from typing import Dict, Any

# 出力カラム定義（ContractInfoSampleに基づく99カラム）
OUTPUT_COLUMNS = [
    "引継番号", "契約者氏名", "契約者カナ", "契約者生年月日", "契約者TEL自宅", 
    "契約者TEL携帯", "契約者現住所郵便番号", "契約者現住所1", "契約者現住所2", "契約者現住所3",
    "引継情報", "物件名", "部屋番号", "物件住所郵便番号", "物件住所1",
    "物件住所2", "物件住所3", "入居ステータス", "滞納ステータス", "受託状況",
    "月額賃料", "管理費", "共益費", "水道代", "駐車場代",
    "その他費用1", "その他費用2", "敷金", "礼金", "回収口座金融機関CD",
    "回収口座金融機関名", "回収口座支店CD", "回収口座支店名", "回収口座種類", "回収口座番号",
    "回収口座名義", "契約種類", "管理受託日", "保証開始日", "保証終了日",
    "AN", "AO", "AP", "管理前滞納額", "更新契約手数料",
    "退去手続き（実費）", "AT", "AU", "クライアントCD", "AW",
    "契約者勤務先名", "AY", "契約者勤務先TEL", "勤務先業種", "契約者勤務先郵便番号",
    "契約者勤務先住所1", "契約者勤務先住所2", "契約者勤務先住所3", "保証人1氏名", "保証人1カナ",
    "保証人1契約者との関係", "保証人1生年月日", "保証人1郵便番号", "保証人1住所1", "保証人1住所2",
    "保証人1住所3", "保証人1TEL自宅", "保証人1TEL携帯", "保証人2氏名", "保証人2カナ",
    "保証人2契約者との関係", "保証人2生年月日", "保証人2郵便番号", "保証人2住所1", "保証人2住所2",
    "保証人2住所3", "保証人2TEL自宅", "保証人2TEL携帯", "緊急連絡人1氏名", "緊急連絡人1カナ",
    "緊急連絡人1契約者との関係", "緊急連絡人1郵便番号", "緊急連絡人1住所1", "緊急連絡人1住所2", "緊急連絡人1住所3",
    "緊急連絡人1TEL自宅", "緊急連絡人1TEL携帯", "緊急連絡人2氏名", "緊急連絡人2カナ", "緊急連絡人2契約者との関係",
    "緊急連絡人2郵便番号", "緊急連絡人2住所1", "緊急連絡人2住所2", "緊急連絡人2住所3", "緊急連絡人2TEL自宅",
    "緊急連絡人2TEL携帯", "DA", "管理会社", "DC", "DD"
]

# 固定値設定
FIXED_VALUES = {
    "入居ステータス": "入居中",
    "滞納ステータス": "未精算",
    "受託状況": "契約中",
    "回収口座金融機関CD": "310",
    "回収口座金融機関名": "GMOあおぞらネット銀行",
    "回収口座種類": "普通",
    "回収口座名義": "アーク株式会社",
    "契約種類": "バックレント",
    "クライアントCD": "10",
    "水道代": "0",
    "共益費": "0",
    "更新契約手数料": "1",
    "保証人1契約者との関係": "他",
    "保証人2契約者との関係": "他",
    "緊急連絡人1契約者との関係": "他",
    "緊急連絡人2契約者との関係": "他",
    "AN": "0",
    "AO": "0",
    "AP": "0"
}

# カラムマッピング定義
COLUMN_MAPPINGS = {
    # 基本情報
    "引継番号": {"source": "契約番号", "transform": "add_leading_zero"},
    "契約者氏名": {"source": "契約元帳:主契約者", "transform": "remove_fullwidth_space"},
    "契約者カナ": {"source": "主契約者（カナ）", "transform": ["remove_halfwidth_space", "hankaku_to_zenkaku"]},
    "契約者生年月日": {"source": "生年月日1", "validation": "check_birthdate"},
    
    # 電話番号（条件付き）
    "契約者TEL自宅": {"source": "自宅TEL1", "conditional": True},
    "契約者TEL携帯": {"source": "携帯TEL1", "conditional": True, "fallback": "自宅TEL1"},
    
    # 物件情報
    "物件名": {"source": "物件名"},
    "部屋番号": {"source": "部屋番号"},
    
    # 金額情報
    "月額賃料": {"source": "賃料"},
    "管理費": {"source": "管理共益費"},
    "駐車場代": {"source": "駐車場料金"},
    "その他費用1": {"source": "その他料金"},
    "その他費用2": {"source": "決済サービス料"},
    "管理前滞納額": {"source": "未収金額合計"},
    
    # 口座情報
    "回収口座支店CD": {"source": "バーチャル口座（支店）"},
    "回収口座支店名": {"source": "バーチャル口座（支店）"},
    "回収口座番号": {"source": "バーチャル口座（口座番号）"},
    
    # 勤務先情報
    "契約者勤務先名": {"source": "勤務先1"},
    "契約者勤務先TEL": {"source": "勤務先TEL1"},
    
    # 管理会社
    "管理会社": {"source": "取引先"}
}

# 住所分割対象
ADDRESS_SPLIT_TARGETS = {
    "物件住所": {
        "postal_code": "契約者現住所郵便番号",
        "prefecture": "契約者現住所1",
        "city": "契約者現住所2",
        "remainder": "契約者現住所3",
        "append_to_remainder": ["物件名", "部屋番号"]
    },
    "物件住所_property": {
        "source": "物件住所",
        "postal_code": "物件住所郵便番号",
        "prefecture": "物件住所1",
        "city": "物件住所2",
        "remainder": "物件住所3"
    },
    "勤務先住所1": {
        "postal_code": "契約者勤務先郵便番号",
        "prefecture": "契約者勤務先住所1",
        "city": "契約者勤務先住所2",
        "remainder": "契約者勤務先住所3"
    }
}

# 検証ルール
VALIDATION_RULES = {
    "birthdate_min_year": 1900,
    "required_fields": ["契約番号", "契約元帳:主契約者"],
    "duplicate_check_column": "引継番号"
}

# 都道府県リスト
PREFECTURES = [
    "北海道", "青森県", "岩手県", "宮城県", "秋田県", "山形県", "福島県",
    "茨城県", "栃木県", "群馬県", "埼玉県", "千葉県", "東京都", "神奈川県",
    "新潟県", "富山県", "石川県", "福井県", "山梨県", "長野県", "岐阜県",
    "静岡県", "愛知県", "三重県", "滋賀県", "京都府", "大阪府", "兵庫県",
    "奈良県", "和歌山県", "鳥取県", "島根県", "岡山県", "広島県", "山口県",
    "徳島県", "香川県", "愛媛県", "高知県", "福岡県", "佐賀県", "長崎県",
    "熊本県", "大分県", "宮崎県", "鹿児島県", "沖縄県"
]

def load_mapping_definition() -> Dict[str, Any]:
    """マッピング定義ファイルを読み込む"""
    mapping_file = Path(__file__).parent / "mapping_definition.json"
    if mapping_file.exists():
        with open(mapping_file, "r", encoding="utf-8") as f:
            return json.load(f)
    return {}

def get_config() -> Dict[str, Any]:
    """設定情報を取得"""
    return {
        "output_columns": OUTPUT_COLUMNS,
        "fixed_values": FIXED_VALUES,
        "column_mappings": COLUMN_MAPPINGS,
        "address_split_targets": ADDRESS_SPLIT_TARGETS,
        "validation_rules": VALIDATION_RULES,
        "prefectures": PREFECTURES,
        "encoding": "cp932"
    }